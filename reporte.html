<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reporte Registros</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <script src="js/jquery.min.js"  type='text/javascript'></script>
    <script src="js/qrcode.js"  type='text/javascript'></script>
</head>
<body>
    <div>
    <div class="banner">
        <img src="jpg/imagen_fondo_kia_LOW.jpg" alt="" srcset="" id="imagenBack" class="imagenPortada">
        <!-- <img src="jpg/logo/1216_Kia_basic_logo_White_no_background.png" alt="" srcset="" class="logo" id="imagenLogo"> -->
    </div>
    <div class="cuerpo centrado" id="cuerpo">
        <div class="titulo"><B>REPORTE REGISTROS DIARIOS KIA</B></div>
        <h1>Temporada 3</h1>
        <a href="" onclick="detalle()" class="liga" id="liga9">
            <div class="titulo">26 DE OCTUBRE 2023:</div><span id="dia9" class="contador"> 0 personas</span>
        </a>
        <br><br>
        <a href="" onclick="detalle()" class="liga" id="liga10">
            <div class="titulo">27 DE OCTUBRE 2023:</div><span id="dia10" class="contador"> 0 personas</span>
        </a>
        <br><br>
        <a href="" onclick="detalle()" class="liga" id="liga11">
            <div class="titulo">28 DE OCTUBRE 2023:</div><span id="dia11" class="contador"> 0 personas</span>
        </a>
        <br><br>
        <a href="" onclick="detalle()" class="liga" id="liga12">
            <div class="titulo">28 DE OCTUBRE 2023:</div><span id="dia12" class="contador"> 0 personas</span>
        </a>
        <br><br>
        <a href="reporteCompletoSemana3.html"  class="liga">
            <div class="titulo">Reporte Completo 4 días OCTUBRE</div>
            <img id="" class="imagenLogo" src="jpg/reporte.png" alt="" srcset="">
        </a>
        <br><br>
        <hr class="linea">
        <h1>Temporada 2</h1>
        <a href="" onclick="detalle()" class="liga" id="liga4">
            <div class="titulo">10 DE AGOSTO 2023:</div><span id="dia4" class="contador"> 0 personas</span>
        </a>
        <br><br>
        <a href="" onclick="detalle()" class="liga" id="liga5">
            <div class="titulo">11 DE AGOSTO 2023:</div><span id="dia5" class="contador"> 0 personas</span>
        </a>
        <br><br>
        <a href="" onclick="detalle()" class="liga" id="liga6">
            <div class="titulo">12 DE AGOSTO 2023:</div><span id="dia6" class="contador"> 0 personas</span>
        </a>
        <br><br>
        <a href="" onclick="detalle()" class="liga" id="liga7">
            <div class="titulo">13 DE AGOSTO 2023:</div><span id="dia7" class="contador"> 0 personas</span>
        </a>
        <br><br>
        <a href="" onclick="detalle()" class="liga" id="liga8">
            <div class="titulo">19 DE AGOSTO 2023:</div><span id="dia8" class="contador"> 0 personas</span>
        </a>
        <br><br>
        <a href="reporteCompletoSemana2.html"  class="liga">
            <div class="titulo">Reporte Completo 5 días AGOSTO</div>
            <img id="" class="imagenLogo" src="jpg/reporte.png" alt="" srcset="">
        </a>
        <br><br>
        <hr class="linea">
        <h1>Temporada 1</h1>
        <a href="" onclick="detalle()" class="liga" id="liga1">
            <div class="titulo">26 DE MAYO 2023:</div><span id="dia1" class="contador"> 0 personas</span>
        </a>
        <br><br>
        <a href="" onclick="detalle()" class="liga" id="liga2">
            <div class="titulo">27 DE MAYO 2023:</div><span id="dia2" class="contador"> 0 personas</span>
        </a>
        <br><br>
        <a href="" onclick="detalle()" class="liga" id="liga3">
            <div class="titulo">28 DE MAYO 2023:</div><span id="dia3" class="contador"> 0 personas</span>
        </a>
        <br>
        <!-- <button class="boton" onclick="cargaDatos()">Recargar Datos</button> -->
        <br><br>
        <a href="reporteCompletoSemana1.html"  class="liga">
            <div class="titulo">Reporte Completo 3 días MAYO</div>
            <img id="" class="imagenLogo" src="jpg/reporte.png" alt="" srcset="">
        </a>
        <br><br>
        </div>
    </div>  
    <script type="text/javascript">
        (async() => {
            // console.log('before start');
            await checkCookie();
            // console.log('after start');
            })();

            async function compruebaUsuario(correoAdministrador){
                const data = {
                    correoAdministrador : correoAdministrador
                }
                let url1 = 'https://mosaico.app:4000/Kia/validaAdministradorConMail'
                const response = await fetch(url1, {
                method: 'POST',
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                },
                mode: 'cors', // no-cors, *cors, same-origin
                body: JSON.stringify(data)
                })
                
                const dataFinal = await response.json();
                let result = dataFinal.result
                if (result == true){
                    return dataFinal.message[0].correoAdministrador
                }else{
                    return ''
                }
            }

            function setCookie(cname, cvalue, exdays) {
                const d = new Date();
                d.setTime(d.getTime() + (exdays * 24 * 60 * 60 * 1000));
                let expires = "expires="+d.toUTCString();
                document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
            }

            function getCookie(cname) {
                let name = cname + "=";
                let ca = document.cookie.split(';');
                for(let i = 0; i < ca.length; i++) {
                    let c = ca[i];
                    while (c.charAt(0) == ' ') {
                    c = c.substring(1);
                    }
                    if (c.indexOf(name) == 0) {
                    return c.substring(name.length, c.length);
                    }
                }
                return "";
            }

            async function checkCookie() {
                let correoAdministrador = getCookie("correoAdministrador");
                if (correoAdministrador != "") {
                    let resultado = await compruebaUsuario(correoAdministrador)
                    if (resultado != ''){
                        //TRUE ponemos links
                        cargaDatos()
                    }else{
                        //FALSE borramos cookie
                        setCookie("correoAdministrador", '', 60);
                        checkCookie()
                    }
                } else {
                    correoAdministrador = prompt("Ingresa correo electrónico de Administrador", "");
                    if (correoAdministrador != "" && correoAdministrador != null) {
                        let resultado = await compruebaUsuario(correoAdministrador)
                        if (resultado != ''){
                            //TRUE guardamos QR y ponemos links
                            setCookie("correoAdministrador", correoAdministrador, 60);
                            cargaDatos()
                        }else{
                            //FALSE pagina en blanco
                            creaMensaje()
                        }
                    }else{
                        //FALSE pagina en blanco
                        creaMensaje()
                    }
                }
            }

            function creaMensaje(){
                let nuevo = document.getElementById("cuerpo")
                nuevo.innerHTML = `
                    <h1>Area restringida con contraseña</h1>
                `;     
            }

        async function cargaDatos(){
            let dataJson = {}
            //----------
            const settings = {
                method: 'GET',
                headers: {
                    Accept: 'application/json',
                    'Content-Type': 'application/json',
                }
            };
                
            try {
                const fetchResponse1 = await fetch(`https://mosaico.app:4000/Kia/temporada1/dameReportePorDia`, settings);
                const data1 = await fetchResponse1.json();
                let resul1 = data1.statusCode

                const fetchResponse2 = await fetch(`https://mosaico.app:4000/Kia/temporada2/dameReportePorDia`, settings);
                const data2 = await fetchResponse2.json();
                let resul2 = data2.statusCode

                const fetchResponse3 = await fetch(`https://mosaico.app:4000/Kia/temporada3/dameReportePorDia`, settings);
                const data3 = await fetchResponse3.json();
                let resul3 = data3.statusCode

                /* let resul = 200; */
                if(resul1 == 200){
                    console.log("Datos del reporte correctos")

                    let dia1 = data1.message[0].numRegistros
                    document.getElementById("dia1").innerHTML = dia1 + " personas"
                    document.getElementById("liga1").href = "reporteDetalleSemana1.html?diaEspecifico=" + data1.message[0].fechaRegistro 

                    let dia2 = data1.message[1].numRegistros
                    document.getElementById("dia2").innerHTML = dia2 + " personas"
                    document.getElementById("liga2").href = "reporteDetalleSemana1.html?diaEspecifico=" + data1.message[1].fechaRegistro

                    let dia3 = data1.message[2].numRegistros
                    document.getElementById("dia3").innerHTML = dia3 + " personas"   
                    document.getElementById("liga3").href = "reporteDetalleSemana1.html?diaEspecifico=" + data1.message[2].fechaRegistro
                }
                if(resul2 == 200){ 
                    let dia4 = data2.message[0].numRegistros
                    document.getElementById("dia4").innerHTML = dia4 + " personas"   
                    document.getElementById("liga4").href = "reporteDetalleSemana2.html?diaEspecifico=" + data2.message[0].fechaRegistro
                
                    let dia5 = data2.message[1].numRegistros
                    document.getElementById("dia5").innerHTML = dia5 + " personas"   
                    document.getElementById("liga5").href = "reporteDetalleSemana2.html?diaEspecifico=" + data2.message[1].fechaRegistro
                
                    let dia6 = data2.message[2].numRegistros
                    document.getElementById("dia6").innerHTML = dia6 + " personas"   
                    document.getElementById("liga6").href = "reporteDetalleSemana2.html?diaEspecifico=" + data2.message[2].fechaRegistro
                
                    let dia7 = data2.message[3].numRegistros
                    document.getElementById("dia7").innerHTML = dia7 + " personas"   
                    document.getElementById("liga7").href = "reporteDetalleSemana2.html?diaEspecifico=" + data2.message[3].fechaRegistro

                    let dia8 = data2.message[4].numRegistros
                    document.getElementById("dia8").innerHTML = dia8 + " personas"
                    document.getElementById("liga8").href = "reporteDetalleSemana3.html?diaEspecifico=" + data2.message[4].fechaRegistro 
                }
                if(resul3 == 200){ 
                    let dia9 = data3.message[0].numRegistros
                    document.getElementById("dia9").innerHTML = dia9 + " personas"   
                    document.getElementById("liga9").href = "reporteDetalleSemana3.html?diaEspecifico=" + data3.message[0].fechaRegistro
                
                    let dia10 = data3.message[1].numRegistros
                    document.getElementById("dia10").innerHTML = dia10 + " personas"   
                    document.getElementById("liga10").href = "reporteDetalleSemana3.html?diaEspecifico=" + data3.message[1].fechaRegistro
                
                    let dia11 = data3.message[2].numRegistros
                    document.getElementById("dia11").innerHTML = dia11 + " personas"   
                    document.getElementById("liga11").href = "reporteDetalleSemana3.html?diaEspecifico=" + data3.message[2].fechaRegistro
                
                    let dia12 = data3.message[3].numRegistros
                    document.getElementById("dia12").innerHTML = dia12 + " personas"   
                    document.getElementById("liga12").href = "reporteDetalleSemana3.html?diaEspecifico=" + data3.message[3].fechaRegistro
                }
                if((resul1!=200) && (resul2!=200) && (resul2!=200)){
                    console.log("Error: " + data.message);  
                }
            } catch (e) {
                console.log("Error:" + e);
            }
            //----------
        }
        
    </script>
</body>
</html>